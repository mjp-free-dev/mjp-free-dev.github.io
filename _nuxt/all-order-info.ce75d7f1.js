import{_ as z}from"./AppProductsGrid.vue.233153e4.js";import{f as q,r as v,i as K,j as $,o as P,k as S,w as p,q as _,s as E,b as c,n as I,v as H,g as B,d as Q,S as W,O as X}from"./entry.3e9d827f.js";import{A as g}from"./AppCardGroup.2aac9bb3.js";import{A as Y}from"./AppCardLayout.3a81efac.js";import Z from"./order-discussion.5d203d1c.js";import{_ as tt}from"./order-form-ro.vue.5855ba00.js";import{_ as et}from"./AppOrderPublicStatusForm.vue.5fd16d92.js";import{s as at}from"./button.esm.bde35740.js";import{A as rt}from"./AppCard.4c49263b.js";import{D as V}from"./datetime.f31b9a37.js";import"./app-grid.vue.173d388d.js";import"./inputnumber.esm.83e8c869.js";import"./inputtext.esm.464edc1b.js";import"./dropdown.esm.58a7e6a3.js";import"./index.esm.f6b0c56a.js";import"./index.esm.b0d6349c.js";import"./overlayeventbus.esm.b8c20756.js";import"./virtualscroller.esm.efd39c52.js";import"./tristatecheckbox.esm.aa242f23.js";import"./checkbox.esm.4ffa3826.js";import"./overlaypanel.esm.614b7856.js";import"./index.esm.a2cb2f62.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./order-discussion-message.c8f05eac.js";function O(t){if(Number.isFinite(t))return t}function G(t){if(typeof t!="string")return;const r=V.fromFormat(t,"yyyy-MM-dd");if(r.isValid)return r.toJSDate()}function U(t){if(typeof t=="object"&&t instanceof Date){const r=V.fromJSDate(t);if(r.isValid)return r.toFormat("yyyy-MM-dd")}if(typeof t=="string"){const r=V.fromFormat("yyyy-MM-dd",t);if(r.isValid)return r.toFormat("yyyy-MM-dd")}}const ot=q({__name:"AppOrderPrivateStatusForm",props:{id:{},readonly:{type:Boolean},data:{}},emits:["update"],setup(t,{emit:r}){const o=t,m=v(null),a=v(null);K(()=>{a.value={deliveryDate:G(o.data.deliveryDate),shippingDate:G(o.data.shippingDate),notes:o.data.notes,totalPriceNet:O(o.data.totalPriceNet),totalPriceGross:O(o.data.totalPriceGross)},m.value=[{$formkit:"primeInputNumber",name:"totalPriceNet",label:"Итого цена нетто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeInputNumber",name:"totalPriceGross",label:"Итого цена брутто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeCalendar",name:"deliveryDate",label:"Дата доставки",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeCalendar",name:"shippingDate",label:"Дата выдачи",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeTextarea",name:"notes",label:"Заметки",rows:"5",_disabled:o.readonly}]});const e=v(null);function N(){var i;(i=e.value)==null||i.node.submit()}function b(){if(!a.value)return;const{deliveryDate:i,shippingDate:s,notes:h}=a.value;r("update",{deliveryDate:U(i),shippingDate:U(s),notes:h})}return(i,s)=>{const h=$("FormKitSchema"),D=at,k=$("FormKit");return P(),S(rt,{basis:"500px",title:"Учёт заказа #"+o.id},{default:p(()=>[_(m)&&_(a)?(P(),S(k,{key:0,ref_key:"form",ref:e,modelValue:_(a),"onUpdate:modelValue":s[1]||(s[1]=T=>E(a)?a.value=T:null),type:"form",actions:!1,onSubmit:b},{default:p(()=>[c(h,{schema:_(m)},null,8,["schema"]),o.readonly?I("",!0):(P(),S(D,{key:0,label:"Обновить",onClick:s[0]||(s[0]=()=>N())}))]),_:1},8,["modelValue"])):I("",!0)]),_:1},8,["title"])}}}),Tt=q({__name:"all-order-info",setup(t){const m=H().query.orderId,a=Number(Array.isArray(m)?m[0]:m),e=v(null),N=v(void 0),b=v(null),i=v(null),s=B(W),h=B(X);async function D(){e.value=null,b.value=null,i.value=null;const u=(await h.getAllOrders(a))[0];e.value=u;const{id:n,vatDocumentRequired:d,shippingMethodName:y,comment:l,orderStatusTypeId:w,productsPriceToPay:F,totalPriceToPay:x,shippingPriceToPay:A,deliveryDate:M,shippingDate:C,notes:R,totalPriceNet:j,totalPriceGross:J}=u;N.value={id:n,vatDocumentRequired:d,shippingMethodName:y,comment:l},b.value={orderStatusTypeId:w,productsPriceToPay:F,totalPriceToPay:x,shippingPriceToPay:A},i.value={deliveryDate:M,shippingDate:C,notes:R,totalPriceNet:j,totalPriceGross:J}}K(D);async function k(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d}=e.value,{orderStatusTypeId:y,shippingPriceToPay:l}=f;await s.set(async w=>w.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:{shippingPriceToPay:l},newProductsPublicStatus:d.productsPublicStatus,newPrivateStatus:n.privateStatus,newProductsPrivateStatus:n.productsPrivateStatus})),await D()}async function T(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d,orderStatusTypeId:y}=e.value;await s.set(async l=>l.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:d.publicStatus,newProductsPublicStatus:d.productsPublicStatus,newPrivateStatus:f,newProductsPrivateStatus:n.productsPrivateStatus})),await D()}async function L(f){if(!e.value)return;const{id:u,orderPrivateStatus:n,orderPublicStatus:d,orderStatusTypeId:y}=e.value,l=[],w=[];for(const F of f){const{priceToPay:x,priceGross:A,priceMarkup:M,priceNet:C}=F;l.push({priceToPay:x}),w.push({priceGross:A,priceMarkup:M,priceNet:C})}await s.set(async F=>F.rpc("updateOrderStatus",{orderId:u,newTypeId:y,newPublicStatus:d.publicStatus,newProductsPublicStatus:l,newPrivateStatus:n.privateStatus,newProductsPrivateStatus:w})),await D()}return(f,u)=>{const n=z;return P(),S(Y,null,{default:p(()=>[c(g,null,{default:p(()=>[e.value?(P(),S(n,{key:0,items:e.value.products,mode:"moder",onUpdate:L},null,8,["items"])):I("",!0)]),_:1}),c(g,null,{default:p(()=>[c(tt,{data:N.value},null,8,["data"])]),_:1}),Q("> "),c(g,null,{default:p(()=>[b.value?(P(),S(et,{key:0,id:_(a),data:b.value,readonly:!1,onUpdate:k},null,8,["id","data"])):I("",!0)]),_:1}),c(g,null,{default:p(()=>[i.value?(P(),S(ot,{key:0,id:_(a),data:i.value,readonly:!1,onUpdate:T},null,8,["id","data"])):I("",!0)]),_:1}),c(g,null,{default:p(()=>[c(Z,{"order-id":_(a),mode:"moder"},null,8,["order-id"])]),_:1})]),_:1})}}});export{Tt as default};
//# sourceMappingURL=all-order-info.ce75d7f1.js.map
