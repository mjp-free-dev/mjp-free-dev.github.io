{"version":3,"file":"AppOrderPublicStatusForm.vue.46f70428.js","sources":["../../../../src/components/app/AppOrderPublicStatusForm.vue"],"sourcesContent":["<template>\r\n  <AppCard\r\n    basis=\"500px\"\r\n    :title=\"'Статус заказа #' + props.id\"\r\n  >\r\n    <FormKit\r\n      v-if=\"orderSchema && model\"\r\n      v-model=\"model\"\r\n      ref=\"form\"\r\n      type=\"form\"\r\n      :actions=\"false\"\r\n      @submit=\"onValidSubmit\"\r\n    >\r\n      <FormKitSchema :schema=\"orderSchema\" />\r\n      <Button\r\n        v-if=\"!props.readonly\"\r\n        label=\"Обновить\"\r\n        @click=\"() => onSubmit()\"\r\n      />\r\n    </FormKit>\r\n  </AppCard>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport AppCard from '@/components/markup/AppCard.vue';\r\nimport {ListItemService} from '@/services/list-item.service';\r\nimport {FormKitNode} from '@formkit/core';\r\n\r\nconst emit = defineEmits<{\r\n  (event: 'update', data: OrderPublicStatusUpdateData): void;\r\n}>();\r\n\r\nconst props = defineProps<{\r\n  id: number;\r\n  readonly?: boolean;\r\n  data: OrderPublicStatusDisplayData;\r\n}>();\r\nconst orderSchema = ref(null as null | any[]);\r\nconst model = ref(null as null | OrderPublicStatusDisplayData);\r\nconst service = useService(ListItemService);\r\n\r\nonMounted(async () => {\r\n  const options = await service.getEnabledOrderStatusTypes();\r\n\r\n  model.value = {\r\n    orderStatusTypeId: props.data.orderStatusTypeId,\r\n    shippingPriceToPay: undefinedIfNotFinite(props.data.shippingPriceToPay),\r\n    productsPriceToPay: undefinedIfNotFinite(props.data.productsPriceToPay),\r\n    totalPriceToPay: undefinedIfNotFinite(props.data.totalPriceToPay),\r\n  };\r\n\r\n  orderSchema.value = [\r\n    {\r\n      $formkit: 'primeDropdown',\r\n      name: 'orderStatusTypeId',\r\n      label: 'Статус',\r\n      validation: 'required',\r\n      _disabled: props.readonly,\r\n      options,\r\n    },\r\n    {\r\n      $formkit: 'primeInputNumber',\r\n      name: 'shippingPriceToPay',\r\n      label: 'К оплате за доставку',\r\n      suffix: ' PLN',\r\n      minFractionDigits: 2,\r\n      maxFractionDigits: 2,\r\n      validation: 'min:0.01|max:1000000000',\r\n      _disabled: props.readonly,\r\n    },\r\n    {\r\n      $formkit: 'primeInputNumber',\r\n      name: 'productsPriceToPay',\r\n      label: 'К оплате за товары',\r\n      suffix: ' PLN',\r\n      minFractionDigits: 2,\r\n      maxFractionDigits: 2,\r\n      validation: 'min:0.01|max:1000000000',\r\n      _disabled: true,\r\n    },\r\n    {\r\n      $formkit: 'primeInputNumber',\r\n      name: 'totalPriceToPay',\r\n      label: 'Итого к оплате',\r\n      suffix: ' PLN',\r\n      minFractionDigits: 2,\r\n      maxFractionDigits: 2,\r\n      validation: 'min:0.01|max:1000000000',\r\n      _disabled: true,\r\n    },\r\n  ];\r\n});\r\n\r\nconst form = ref(null as null | {node: FormKitNode});\r\n\r\nfunction onSubmit() {\r\n  form.value?.node.submit();\r\n}\r\n\r\nfunction onValidSubmit() {\r\n  if (!model.value) {\r\n    return;\r\n  }\r\n\r\n  const {orderStatusTypeId, shippingPriceToPay} = model.value;\r\n\r\n  emit('update', {orderStatusTypeId, shippingPriceToPay});\r\n}\r\n</script>\r\n\r\n<script lang=\"ts\">\r\nexport interface OrderPublicStatusUpdateData {\r\n  orderStatusTypeId: number;\r\n  shippingPriceToPay?: number;\r\n}\r\n\r\nexport interface OrderPublicStatusDisplayData\r\n  extends OrderPublicStatusUpdateData {\r\n  productsPriceToPay?: number;\r\n  totalPriceToPay?: number;\r\n}\r\n\r\nfunction undefinedIfNotFinite(num: unknown) {\r\n  if (Number.isFinite(num)) {\r\n    return num as number;\r\n  }\r\n\r\n  return undefined;\r\n}\r\n</script>\r\n"],"names":["undefinedIfNotFinite","num","orderSchema","ref","model","service","useService","ListItemService","onMounted","options","props","form","onSubmit","_a","onValidSubmit","orderStatusTypeId","shippingPriceToPay","emit"],"mappings":"mNA0HA,SAASA,EAAqBC,EAAc,CACtC,GAAA,OAAO,SAASA,CAAG,EACd,OAAAA,CAIX,yIA3FMC,EAAcC,EAAI,IAAoB,EACtCC,EAAQD,EAAI,IAA2C,EACvDE,EAAUC,EAAWC,CAAe,EAE1CC,EAAU,SAAY,CACd,MAAAC,EAAU,MAAMJ,EAAQ,6BAE9BD,EAAM,MAAQ,CACZ,kBAAmBM,EAAM,KAAK,kBAC9B,mBAAoBV,EAAqBU,EAAM,KAAK,kBAAkB,EACtE,mBAAoBV,EAAqBU,EAAM,KAAK,kBAAkB,EACtE,gBAAiBV,EAAqBU,EAAM,KAAK,eAAe,CAAA,EAGlER,EAAY,MAAQ,CAClB,CACE,SAAU,gBACV,KAAM,oBACN,MAAO,SACP,WAAY,WACZ,UAAWQ,EAAM,SACjB,QAAAD,CACF,EACA,CACE,SAAU,mBACV,KAAM,qBACN,MAAO,uBACP,OAAQ,OACR,kBAAmB,EACnB,kBAAmB,EACnB,WAAY,0BACZ,UAAWC,EAAM,QACnB,EACA,CACE,SAAU,mBACV,KAAM,qBACN,MAAO,qBACP,OAAQ,OACR,kBAAmB,EACnB,kBAAmB,EACnB,WAAY,0BACZ,UAAW,EACb,EACA,CACE,SAAU,mBACV,KAAM,kBACN,MAAO,iBACP,OAAQ,OACR,kBAAmB,EACnB,kBAAmB,EACnB,WAAY,0BACZ,UAAW,EACb,CAAA,CACF,CACD,EAEK,MAAAC,EAAOR,EAAI,IAAkC,EAEnD,SAASS,GAAW,QACbC,EAAAF,EAAA,QAAA,MAAAE,EAAO,KAAK,QACnB,CAEA,SAASC,GAAgB,CACnB,GAAA,CAACV,EAAM,MACT,OAGF,KAAM,CAAC,kBAAAW,EAAmB,mBAAAC,GAAsBZ,EAAM,MAEtDa,EAAK,SAAU,CAAC,kBAAAF,EAAmB,mBAAAC,CAAmB,CAAA,CACxD"}