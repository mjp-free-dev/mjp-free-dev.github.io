import{_ as L}from"./AppProductsGrid.vue.cd000711.js";import{f as U,r as k,i as q,j as V,o as m,k as f,w as p,q as _,s as R,b as S,n as h,v as j,g as $,S as J,O as z}from"./entry.534f2e72.js";import{A as I}from"./AppCardGroup.c6618464.js";import{A as E}from"./AppCardLayout.73481042.js";import H from"./order-discussion.a8e4619d.js";import{_ as Q}from"./order-form-ro.vue.5264ca78.js";import{_ as W}from"./AppOrderPublicStatusForm.vue.ceceaed8.js";import{s as X}from"./button.esm.7c27f938.js";import{A as Y}from"./AppCard.37f97353.js";import{D as M}from"./datetime.f31b9a37.js";import"./app-grid.vue.17642ab2.js";import"./inputnumber.esm.ab71e89e.js";import"./inputtext.esm.b41ebb72.js";import"./dropdown.esm.dbd96c62.js";import"./index.esm.7ce4d5a3.js";import"./index.esm.f2616181.js";import"./overlayeventbus.esm.5f24e9f5.js";import"./virtualscroller.esm.dcbafbae.js";import"./tristatecheckbox.esm.72826baf.js";import"./checkbox.esm.1877d9ca.js";import"./overlaypanel.esm.9c768281.js";import"./index.esm.34743e13.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./order-discussion-message.11905e2a.js";function B(e){if(Number.isFinite(e))return e}function O(e){if(typeof e!="string")return;const r=M.fromFormat(e,"yyyy-MM-dd");if(r.isValid)return r.toJSDate()}function G(e){if(typeof e=="object"&&e instanceof Date){const r=M.fromJSDate(e);if(r.isValid)return r.toFormat("yyyy-MM-dd")}if(typeof e=="string"){const r=M.fromFormat("yyyy-MM-dd",e);if(r.isValid)return r.toFormat("yyyy-MM-dd")}}const Z=U({__name:"AppOrderPrivateStatusForm",props:{id:{},readonly:{type:Boolean},data:{}},emits:["update"],setup(e,{emit:r}){const o=e,y=k(null),a=k(null);q(()=>{a.value={deliveryDate:O(o.data.deliveryDate),shippingDate:O(o.data.shippingDate),notes:o.data.notes,totalPriceNet:B(o.data.totalPriceNet),totalPriceGross:B(o.data.totalPriceGross)},y.value=[{$formkit:"primeInputNumber",name:"totalPriceNet",label:"Итого цена нетто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeInputNumber",name:"totalPriceGross",label:"Итого цена брутто",suffix:" PLN",minFractionDigits:2,maxFractionDigits:2,validation:"min:0.01|max:1000000000",_disabled:!0},{$formkit:"primeCalendar",name:"deliveryDate",label:"Дата доставки",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeCalendar",name:"shippingDate",label:"Дата выдачи",dateFormat:"yy-mm-dd",showButtonBar:!0,_disabled:o.readonly},{$formkit:"primeTextarea",name:"notes",label:"Заметки",rows:"5",_disabled:o.readonly}]});const t=k(null);function b(){var s;(s=t.value)==null||s.node.submit()}function w(){if(!a.value)return;const{deliveryDate:s,shippingDate:n,notes:d}=a.value;r("update",{deliveryDate:G(s),shippingDate:G(n),notes:d})}return(s,n)=>{const d=V("FormKitSchema"),g=X,N=V("FormKit");return m(),f(Y,{basis:"500px",title:"Учёт заказа #"+o.id},{default:p(()=>[_(y)&&_(a)?(m(),f(N,{key:0,ref_key:"form",ref:t,modelValue:_(a),"onUpdate:modelValue":n[1]||(n[1]=T=>R(a)?a.value=T:null),type:"form",actions:!1,onSubmit:w},{default:p(()=>[S(d,{schema:_(y)},null,8,["schema"]),o.readonly?h("",!0):(m(),f(g,{key:0,label:"Обновить",onClick:n[0]||(n[0]=()=>b())}))]),_:1},8,["modelValue"])):h("",!0)]),_:1},8,["title"])}}}),kt=U({__name:"all-order-info",setup(e){const y=j().query.orderId,a=Number(Array.isArray(y)?y[0]:y),t=k(null),b=k(null),w=k(null),s=$(J),n=$(z);async function d(){t.value=null,b.value=null,w.value=null;const u=(await n.getAllOrders(a))[0];t.value=u;const{orderStatusTypeId:i,productsPriceToPay:l,totalPriceToPay:P,shippingPriceToPay:c,deliveryDate:D,shippingDate:F,notes:x,totalPriceNet:A,totalPriceGross:C}=u;b.value={orderStatusTypeId:i,productsPriceToPay:l,totalPriceToPay:P,shippingPriceToPay:c},w.value={deliveryDate:D,shippingDate:F,notes:x,totalPriceNet:A,totalPriceGross:C}}q(d);async function g(v){if(!t.value)return;const{id:u,orderPrivateStatus:i,orderPublicStatus:l}=t.value,{orderStatusTypeId:P,shippingPriceToPay:c}=v;await s.set(async D=>D.rpc("updateOrderStatus",{orderId:u,newTypeId:P,newPublicStatus:{shippingPriceToPay:c},newProductsPublicStatus:l.productsPublicStatus,newPrivateStatus:i.privateStatus,newProductsPrivateStatus:i.productsPrivateStatus})),await d()}async function N(v){if(!t.value)return;const{id:u,orderPrivateStatus:i,orderPublicStatus:l,orderStatusTypeId:P}=t.value;await s.set(async c=>c.rpc("updateOrderStatus",{orderId:u,newTypeId:P,newPublicStatus:l.publicStatus,newProductsPublicStatus:l.productsPublicStatus,newPrivateStatus:v,newProductsPrivateStatus:i.productsPrivateStatus})),await d()}async function T(v){if(!t.value)return;const{id:u,orderPrivateStatus:i,orderPublicStatus:l,orderStatusTypeId:P}=t.value,c=[],D=[];for(const F of v){const{priceToPay:x,priceGross:A,priceMarkup:C,priceNet:K}=F;c.push({priceToPay:x}),D.push({priceGross:A,priceMarkup:C,priceNet:K})}await s.set(async F=>F.rpc("updateOrderStatus",{orderId:u,newTypeId:P,newPublicStatus:l.publicStatus,newProductsPublicStatus:c,newPrivateStatus:i.privateStatus,newProductsPrivateStatus:D})),await d()}return(v,u)=>{const i=L;return m(),f(E,null,{default:p(()=>[S(I,null,{default:p(()=>[t.value?(m(),f(i,{key:0,items:t.value.products,mode:"moder",onUpdate:T},null,8,["items"])):h("",!0)]),_:1}),S(I,null,{default:p(()=>[t.value?(m(),f(Q,{key:0,data:t.value},null,8,["data"])):h("",!0)]),_:1}),S(I,null,{default:p(()=>[b.value?(m(),f(W,{key:0,id:_(a),data:b.value,readonly:!1,onUpdate:g},null,8,["id","data"])):h("",!0)]),_:1}),S(I,null,{default:p(()=>[w.value?(m(),f(Z,{key:0,id:_(a),data:w.value,readonly:!1,onUpdate:N},null,8,["id","data"])):h("",!0)]),_:1}),S(I,null,{default:p(()=>[S(H,{"order-id":_(a),mode:"moder"},null,8,["order-id"])]),_:1})]),_:1})}}});export{kt as default};
