import{f as S,Z as k,l as x,j as V,r as p,o as n,S as _,w as u,a as f,b as d,c as B,C,F as L,h as l,aw as i}from"./entry.7cb56bd3.js";import P from"./product-form.8ce0afe8.js";import h from"./order-form.7ad9c3ce.js";import{_ as N}from"./_plugin-vue_export-helper.c27b6911.js";import"./button.esm.33817917.js";import"./index.esm.aef8f342.js";import"./AppCard.7c3cc825.js";const q={class:"form"},D={class:"products"},K=S({__name:"new-order",setup(U){const m=k(),v=x(),y=V(),r=p(null),s=p({user_id:y.value.id,delivery_type_id:null,comment:"",vat_document_required:!1,products:[{}]});function g(){var t;(t=r.value)==null||t.node.submit()}async function b(t){const{error:e}=await v.from("orders").insert([t]);e?m.add({severity:"error",summary:"Ошибка!",detail:JSON.stringify(e,void 0,2)}):m.add({severity:"success",summary:"Заказ создан!"})}function w(t){return t.value.products.length>0}return(t,e)=>(n(),_(l(i),{ref_key:"form",ref:r,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o),type:"form",validation:"atLeastOneProduct","validation-rules":{atLeastOneProduct:w},"validation-messages":{atLeastOneProduct:"Добавьте хотя бы один товар."},actions:!1,onSubmit:b},{default:u(()=>{var o;return[f("div",q,[f("div",D,[d(l(i),{type:"list",name:"products",dynamic:""},{default:u(({items:c})=>[(n(!0),B(L,null,C(c,(O,a)=>(n(),_(l(i),{key:O,index:a,type:"group"},{default:u(()=>[d(P,{index:a,onDelete:()=>s.value.products=s.value.products.filter((j,F)=>F!==a)},null,8,["index","onDelete"])]),_:2},1032,["index"]))),128))]),_:1})]),d(h,{"msg-source":(o=r.value)==null?void 0:o.node,onAdd:e[0]||(e[0]=c=>s.value.products.push({})),onSubmit:g},null,8,["msg-source"])])]}),_:1},8,["modelValue","validation-rules","validation-messages"]))}});const $=N(K,[["__scopeId","data-v-34d4fd10"]]);export{$ as default};
