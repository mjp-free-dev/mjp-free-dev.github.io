{"version":3,"file":"my-profile.fb35b655.js","sources":["../../../../src/pages/account/my-profile.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport {ref} from 'vue';\r\nimport {FormKitSchemaNode} from '@formkit/core';\r\nimport AppCard from '@/components/markup/AppCard.vue';\r\nimport AppCardGroup from '@/components/markup/AppCardGroup.vue';\r\nimport AppCardLayout from '@/components/markup/AppCardLayout.vue';\r\nimport { AuthService, UserProfile } from '@/services/auth.service';\r\n\r\nconst authService = useService(AuthService);\r\nconst profileSchema = ref(buildSchema(!!getRedirectUrl()));\r\nconst data = ref(null as null | UserProfile);\r\nconst updatePasswordData = ref({newPassword: ''});\r\nconst forceUrl = ref(getRedirectUrl() as string);\r\n\r\nconst router = useRouter();\r\nconst removeRouterHook = router.afterEach(() => {\r\n  forceUrl.value = getRedirectUrl();\r\n  profileSchema.value = buildSchema(!!forceUrl.value);\r\n});\r\n\r\nonMounted(async () => {\r\n  data.value = await authService.getProfile();\r\n});\r\n\r\nonUnmounted(removeRouterHook);\r\n\r\nfunction buildSchema(isForce: boolean): FormKitSchemaNode[] {\r\n  const forceItem = {\r\n    $el: 'p',\r\n    children: 'Заполните профиль, что бы продолжить работу',\r\n  };\r\n\r\n  return [\r\n    ...(isForce ? [forceItem] : []),\r\n    {\r\n      $formkit: 'primeInputText',\r\n      name: 'fullName',\r\n      label: 'Полное имя',\r\n      validation: 'required',\r\n    },\r\n    {\r\n      $formkit: 'primeInputText',\r\n      type: 'tel',\r\n      name: 'phoneNumber',\r\n      label: 'Телефон',\r\n      validation: '',\r\n    },\r\n  ];\r\n}\r\n\r\nfunction getRedirectUrl() {\r\n  const route = useRoute();\r\n  const queryParams = route.query;\r\n  const argArr = queryParams['redirectTo'];\r\n  const arg = Array.isArray(argArr) ? argArr[0] : argArr;\r\n\r\n  return arg ?? '';\r\n}\r\n\r\nasync function profileSubmitHandler() {\r\n  if (!data.value) {\r\n    return;\r\n  }\r\n\r\n  const {fullName, phoneNumber} = data.value;\r\n  await authService.setProfile(fullName, phoneNumber);\r\n\r\n  if (forceUrl.value) {\r\n    router.push(forceUrl.value);\r\n  }\r\n}\r\n\r\nconst updatePasswordSchema: FormKitSchemaNode[] = [\r\n  {\r\n    $formkit: 'primePassword',\r\n    name: 'newPassword',\r\n    label: 'Новый парооль',\r\n    validation: 'required',\r\n    toggleMask: true,\r\n  },\r\n];\r\n\r\nasync function updatePasswordHandler() {\r\n  await authService.setPassword(updatePasswordData.value.newPassword)\r\n}\r\n</script>\r\n\r\n<template>\r\n  <AppCardLayout>\r\n    <AppCardGroup>\r\n      <AppCard title=\"Личная информация\">\r\n        <FormKit\r\n          v-if=\"data\"\r\n          v-model=\"data\"\r\n          type=\"form\"\r\n          :submit-attrs=\"{\r\n            inputClass: 'p-button p-component',\r\n          }\"\r\n          @submit=\"profileSubmitHandler\"\r\n        >\r\n          <FormKitSchema\r\n            :schema=\"profileSchema\"\r\n            :data=\"data\"\r\n          />\r\n        </FormKit>\r\n      </AppCard>\r\n    </AppCardGroup>\r\n    <AppCardGroup>\r\n      <AppCard title=\"Изменить пароль\">\r\n        <FormKit\r\n          v-if=\"data\"\r\n          v-model=\"updatePasswordData\"\r\n          type=\"form\"\r\n          :submit-attrs=\"{\r\n            inputClass: 'p-button p-component',\r\n          }\"\r\n          @submit=\"updatePasswordHandler\"\r\n        >\r\n          <FormKitSchema\r\n            :schema=\"updatePasswordSchema\"\r\n            :data=\"data\"\r\n          />\r\n        </FormKit>\r\n      </AppCard>\r\n    </AppCardGroup>\r\n  </AppCardLayout>\r\n</template>\r\n"],"names":["authService","useService","AuthService","profileSchema","ref","buildSchema","getRedirectUrl","data","updatePasswordData","forceUrl","router","useRouter","removeRouterHook","onMounted","onUnmounted","isForce","argArr","useRoute","profileSubmitHandler","fullName","phoneNumber","updatePasswordSchema","updatePasswordHandler"],"mappings":"oWAQM,MAAAA,EAAcC,EAAWC,CAAW,EACpCC,EAAgBC,EAAIC,EAAY,CAAC,CAACC,EAAgB,CAAA,CAAC,EACnDC,EAAOH,EAAI,IAA0B,EACrCI,EAAqBJ,EAAI,CAAC,YAAa,EAAG,CAAA,EAC1CK,EAAWL,EAAIE,EAAA,CAA0B,EAEzCI,EAASC,IACTC,EAAmBF,EAAO,UAAU,IAAM,CAC9CD,EAAS,MAAQH,IACjBH,EAAc,MAAQE,EAAY,CAAC,CAACI,EAAS,KAAK,CAAA,CACnD,EAEDI,EAAU,SAAY,CACfN,EAAA,MAAQ,MAAMP,EAAY,WAAW,CAAA,CAC3C,EAEDc,EAAYF,CAAgB,EAE5B,SAASP,EAAYU,EAAuC,CAMnD,MAAA,CACL,GAAIA,EAAU,CANE,CAChB,IAAK,IACL,SAAU,6CAAA,CAIc,EAAI,CAAC,EAC7B,CACE,SAAU,iBACV,KAAM,WACN,MAAO,aACP,WAAY,UACd,EACA,CACE,SAAU,iBACV,KAAM,MACN,KAAM,cACN,MAAO,UACP,WAAY,EACd,CAAA,CAEJ,CAEA,SAAST,GAAiB,CAGlB,MAAAU,EAFQC,IACY,MACC,WAG3B,OAFY,MAAM,QAAQD,CAAM,EAAIA,EAAO,CAAC,EAAIA,IAElC,EAChB,CAEA,eAAeE,GAAuB,CAChC,GAAA,CAACX,EAAK,MACR,OAGF,KAAM,CAAC,SAAAY,EAAU,YAAAC,GAAeb,EAAK,MAC/B,MAAAP,EAAY,WAAWmB,EAAUC,CAAW,EAE9CX,EAAS,OACJC,EAAA,KAAKD,EAAS,KAAK,CAE9B,CAEA,MAAMY,EAA4C,CAChD,CACE,SAAU,gBACV,KAAM,cACN,MAAO,gBACP,WAAY,WACZ,WAAY,EACd,CAAA,EAGF,eAAeC,GAAwB,CACrC,MAAMtB,EAAY,YAAYQ,EAAmB,MAAM,WAAW,CACpE"}