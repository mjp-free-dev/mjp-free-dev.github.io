import{f as _,g as y,a9 as b,m as g,j as S,q as u,o as w,x as O,w as V,b as h,h as x,aa as k}from"./entry.a1f6cece.js";import C from"./new-order-form.ef505ff9.js";import"./product-form.1383eff9.js";import"./button.esm.f2e75a5b.js";import"./index.esm.e199cda5.js";import"./AppCard.a532ea68.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./order-form.0e93d768.js";const D=_({__name:"new-order",setup(L){const n=y(),r=b(),i=g(),d=S(),s=u(null),a=u({user_id:d.value.id,delivery_type_id:null,comment:"",vat_document_required:!1,products:[{}]});async function l(e){const{error:t,data:o}=await i.from("orders").insert([e]).select();if(t)r.add({severity:"error",summary:"Ошибка!",detail:JSON.stringify(t,void 0,2)});else{const v=o[0].id;n.push("/user/my-order-info?orderId="+v),r.add({severity:"success",summary:"Заказ создан!"})}}function m(e){return e.value.products.length>0}function c(e){a.value.products.splice(e,1)}function p(){a.value.products.push({})}function f(){var e;(e=s.value)==null||e.node.submit()}return(e,t)=>(w(),O(x(k),{ref_key:"form",ref:s,modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=o=>a.value=o),type:"form",validation:"atLeastOneProduct","validation-rules":{atLeastOneProduct:m},"validation-messages":{atLeastOneProduct:"Добавьте хотя бы один товар."},actions:!1,onSubmit:l},{default:V(()=>{var o;return[h(C,{"msg-source":(o=s.value)==null?void 0:o.node,onAdd:p,onDelete:c,onSubmit:f},null,8,["msg-source"])]}),_:1},8,["modelValue","validation-rules","validation-messages"]))}});export{D as default};
