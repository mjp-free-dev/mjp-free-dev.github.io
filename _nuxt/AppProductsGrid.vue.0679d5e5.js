import{f as p,o as f,k as m,q as g,b as l}from"./entry.6e8d4fb5.js";import{v as y,_,f as h,p as P,s as d,i as k,g as c,c as u}from"./app-grid.vue.1612e8b2.js";import"./button.esm.31c6eab7.js";import"./AppCard.63a6ae7a.js";import"./inputtext.esm.d2459eb8.js";const x=p({__name:"app-form-grid",props:{data:{},config:{}},setup(t){const e=t,a={title:e.config.title,basis:e.config.basis,allowUpdate:e.config.allowUpdate,allowAdd:()=>{e.data.push((e.config.newItemFunc??(()=>({})))(e.data.length))},allowDelete:n=>{var i;const r=e.data.findIndex(o=>o[e.config.dataKey]===n[e.config.dataKey]);r!==-1&&e.data.splice(r,1),(i=e.config.onDeleted)==null||i.call(void 0,n)},allowEdit:!0,props:{dataKey:e.config.dataKey,editMode:"cell",filterDisplay:void 0},emits:{"cell-edit-complete":n=>e.data[n.index][n.field]=n.newValue},getData:()=>Promise.resolve(e.data),hidePaging:!0,labels:e.config.labels,columns:{$validationOutcome:y(e.config.validationFunc),...e.config.columns}};return(n,r)=>(f(),m(g(_),{data:e.data,config:a},null,8,["data"]))}});function w(t,e){if(t.length<=e)return t;const a=t.split("?")[0],n="...",r=e-n.length,i=a.substr(-r);return n+i}function b(t){return{...h,slots:{body:({data:e,field:a})=>{const n=e[a];if(!n)return[];const r=w(n,t);return[l("a",{target:"_blank",style:"text-decoration: underline;",href:n},[r])]}}}}function U(t){const e=b(t);return{...e,slots:{...e.slots,body:({data:a,field:n})=>{const r=a[n];if(!r)return[];const i=w(r,t);return[l("span",null,[i]),l("a",{target:"_blank",style:"text-decoration: underline; margin-left: 5px",href:r},[l("i",{class:"pi pi-play"},null)])]},editor:P}}}function v(t){const e=[];return(!Number.isFinite(t.count)||t.count<1)&&e.push("Количество должно быть больше либо равно 1"),!t.url||!C(t.url)?e.push("Укажите ссылку на товар в формате https://site.com/some-product"):t.url.length>65536&&e.push("Максимальная длинна ссылки 65536"),e}function C(t){return/^(https?):\/\/(([^:\/?#\s]+)(?::(\d+))?)(\/[^?#\s]*)?(\?[^#\s]*)?(#\S*)?$/i.test(t)}const G=p({__name:"AppProductsGrid",props:{onUpdated:{type:Function},items:{},mode:{}},setup(t){const e=t;function a(){var o;for(let s=0;s<((o=e.items)==null?void 0:o.length);s++)e.items[s].id=s+1}const n={basis:"550px",title:"Товары от одного продавца",dataKey:"id",allowUpdate:e.mode==="moder"?()=>(console.log("allowUpdate"),e.onUpdated?(console.log("allowUpdate - true"),e.onUpdated(e.items)):Promise.resolve()):void 0,allowAdd:e.mode==="new",allowEdit:e.mode==="new"||e.mode==="moder",allowDelete:e.mode==="new",onDeleted:()=>a(),newItemFunc:o=>({id:o+1,count:1}),validationFunc:v,labels:{id:"#",url:"Ссылка",count:"Количество",priceToPay:"К оплате",priceNet:"Цена нетто",priceGross:"Цена брутто",priceMarkup:"Наценка"},columns:{id:d,url:e.mode==="new"?U(50):b(50),count:e.mode==="new"?k:d,priceToPay:r(e.mode),priceNet:i(e.mode),priceGross:i(e.mode),priceMarkup:i(e.mode)}};function r(o){return o==="new"?!1:o==="moder"?c:u}function i(o){return o==="moder"?c:o==="moder-ro"?u:!1}return(o,s)=>(f(),m(g(x),{config:n,data:e.items},null,8,["data"]))}});export{G as _,v as p};
