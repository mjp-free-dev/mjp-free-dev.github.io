{"version":3,"file":"all-user-list.2955542c.js","sources":["../../../../src/pages/admin/all-user-list.vue"],"sourcesContent":["<script setup lang=\"tsx\">\r\nimport {\r\n  AppGrid,\r\n  AppGridConfig,\r\n  stringColumnPresetNoEdit,\r\n  severityColumnPreset,\r\n  currencyColumnPresetNoEdit,\r\n} from '@/components/grid';\r\nimport {SupabaseService} from '@/services/supabase.service';\r\n\r\nconst grid = ref(null as null | InstanceType<typeof AppGrid>);\r\nconst service = useService(SupabaseService);\r\n\r\ninterface UserTableRow {\r\n  id: string;\r\n  displayId: number;\r\n  fullName: string;\r\n  email: string;\r\n  phoneNumber: string;\r\n  plnBalance: number;\r\n  accessLevel: number;\r\n}\r\n\r\nasync function getData() {\r\n  const data = await service.getMany(async x =>\r\n    x\r\n      .from('userPublicProfile')\r\n      .select('*, userPrivateProfile(*), userBalance(*), userClaim!userClaim_id_fkey(*)'),\r\n  );\r\n\r\n  return data.map(x => {\r\n    const {id, fullName, displayId} = x;\r\n    const {plnBalance} = x.userBalance[0] ?? x.userBalance;\r\n    const {email, phoneNumber} =\r\n      x.userPrivateProfile[0] ?? x.userPrivateProfile;\r\n    const {accessLevel} = (x.userClaim ? x.userClaim[0] : null) ??\r\n      (x.userClaim as any as {accessLevel: number}) ?? {accessLevel: 1};\r\n\r\n    return {\r\n      id,\r\n      fullName,\r\n      displayId,\r\n      plnBalance,\r\n      email,\r\n      phoneNumber,\r\n      accessLevel,\r\n    } as UserTableRow;\r\n  });\r\n}\r\n\r\nasync function onRowEditSave(data: UserTableRow) {\r\n  const {id, accessLevel} = data;\r\n\r\n  await service.set(async x => x.rpc('updateUserClaim', {userId: id, newAccessLevel: accessLevel}));\r\n  await grid.value?.refresh();\r\n}\r\n\r\nconst config: AppGridConfig<UserTableRow> = {\r\n  title: 'Все пользователи',\r\n  getData,\r\n  allowEdit: true,\r\n  emits: {\r\n    'row-edit-save': e => onRowEditSave(e.newData),\r\n  },\r\n  labels: {\r\n    id: '',\r\n    displayId: '#',\r\n    fullName: 'Имя',\r\n    email: 'Email',\r\n    phoneNumber: 'Телефон',\r\n    plnBalance: 'Баланс (PLN)',\r\n    accessLevel: 'Доступ',\r\n  },\r\n  columns: {\r\n    id: false,\r\n    displayId: stringColumnPresetNoEdit,\r\n    fullName: stringColumnPresetNoEdit,\r\n    email: stringColumnPresetNoEdit,\r\n    phoneNumber: stringColumnPresetNoEdit,\r\n    plnBalance: currencyColumnPresetNoEdit,\r\n    accessLevel: severityColumnPreset([\r\n      {\r\n        value: 1,\r\n        label: 'Пользователь',\r\n        severity: 'info',\r\n      },\r\n      {\r\n        value: 2,\r\n        label: 'Модератор',\r\n        severity: 'warning',\r\n      },\r\n      {\r\n        value: 3,\r\n        label: 'Администратор',\r\n        severity: 'danger',\r\n      },\r\n    ]),\r\n  },\r\n};\r\n</script>\r\n\r\n<template>\r\n  <AppGrid\r\n    ref=\"grid\"\r\n    :config=\"config\"\r\n  />\r\n</template>\r\n"],"names":["grid","ref","service","useService","SupabaseService","getData","getMany","x","from","select","map","id","fullName","displayId","plnBalance","userBalance","email","phoneNumber","userPrivateProfile","accessLevel","userClaim","onRowEditSave","data","set","rpc","userId","newAccessLevel","value","refresh","config","title","allowEdit","emits","e","newData","labels","columns","stringColumnPresetNoEdit","currencyColumnPresetNoEdit","severityColumnPreset","label","severity"],"mappings":"guBAUA,MAAMA,EAAOC,EAAI,IAA2C,EACtDC,EAAUC,EAAWC,CAAe,EAY1C,eAAeC,GAAU,CAOvB,OANa,MAAMH,EAAQI,QAAQ,MAAMC,GACvCA,EACGC,KAAK,mBAAmB,EACxBC,OAAO,0EAA0E,CACtF,GAEYC,IAAIH,GAAK,CACnB,KAAM,CAACI,GAAAA,EAAIC,SAAAA,EAAUC,UAAAA,CAAU,EAAGN,EAC5B,CAACO,WAAAA,CAAW,EAAGP,EAAEQ,YAAY,CAAC,GAAKR,EAAEQ,YACrC,CAACC,MAAAA,EAAOC,YAAAA,CAAY,EACxBV,EAAEW,mBAAmB,CAAC,GAAKX,EAAEW,mBACzB,CAACC,YAAAA,CAAW,GAAKZ,EAAEa,UAAYb,EAAEa,UAAU,CAAC,EAAI,OACnDb,EAAEa,WAA8C,CAACD,YAAa,GAEjE,MAAO,CACLR,GAAAA,EACAC,SAAAA,EACAC,UAAAA,EACAC,WAAAA,EACAE,MAAAA,EACAC,YAAAA,EACAE,YAAAA,EAEJ,CAAC,CACH,CAEA,eAAeE,EAAcC,EAAoB,OAC/C,KAAM,CAACX,GAAAA,EAAIQ,YAAAA,CAAY,EAAGG,EAE1B,MAAMpB,EAAQqB,IAAI,MAAMhB,GAAKA,EAAEiB,IAAI,kBAAmB,CAACC,OAAQd,EAAIe,eAAgBP,CAAY,CAAA,CAAC,EAChG,OAAMnB,EAAAA,EAAK2B,QAAL3B,YAAAA,EAAY4B,UACpB,CAEA,MAAMC,EAAsC,CAC1CC,MAAO,mBACPzB,QAAAA,EACA0B,UAAW,GACXC,MAAO,CACL,gBAAiBC,GAAKZ,EAAcY,EAAEC,OAAO,CAC9C,EACDC,OAAQ,CACNxB,GAAI,GACJE,UAAW,IACXD,SAAU,MACVI,MAAO,QACPC,YAAa,UACbH,WAAY,eACZK,YAAa,QACd,EACDiB,QAAS,CACPzB,GAAI,GACJE,UAAWwB,EACXzB,SAAUyB,EACVrB,MAAOqB,EACPpB,YAAaoB,EACbvB,WAAYwB,EACZnB,YAAaoB,EAAqB,CAChC,CACEZ,MAAO,EACPa,MAAO,eACPC,SAAU,MACZ,EACA,CACEd,MAAO,EACPa,MAAO,YACPC,SAAU,SACZ,EACA,CACEd,MAAO,EACPa,MAAO,gBACPC,SAAU,QACZ,CAAC,CACF,CACH"}