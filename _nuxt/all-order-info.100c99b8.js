import{f as b,E as C,r as y,q as k,s as x,j as A,o as i,k as u,w as s,b as n,z as m,y as _,B as w}from"./entry.3eeb7ad7.js";import{A as q}from"./AppCardGroup.e1de8908.js";import{A as S}from"./AppCardLayout.c0a81ec9.js";import B from"./order-discussion.3a91d3d3.js";import g from"./new-order-form.d72f0020.js";import{_ as v}from"./status-form.vue.03f95d7c.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./inputtext.esm.45cd8726.js";import"./button.esm.80d429ee.js";import"./index.esm.2ade5b5f.js";import"./AppCard.b8a305ce.js";import"./order-discussion-message.16f4b32d.js";import"./product-form.098e7b15.js";import"./order-form.vue.6b87d65d.js";const Q=b({__name:"all-order-info",setup(F){const l=C().query.orderId,d=Number(Array.isArray(l)?l[0]:l),o=y(null),c=y(null),p=k();async function f(){var t;const r=await w().from("order").select("*, orderStatus(*)").eq("id",d);o.value=(t=r.data)==null?void 0:t.at(0)}x(f);function P(){var e;console.log("fff"),(e=c.value)==null||e.node.submit()}async function I(e){console.log(e);const r=w(),t={orderId:e.id,newTypeId:e.typeId,newBuyPrice:e.buyPrice,newSellPrice:e.newSellPrice};console.log(t);const{error:a,data:V}=await r.rpc("updateOrderStatus",{orderId:e.id,newTypeId:e.typeId,newBuyPrice:e.buyPrice,newSellPrice:e.sellPrice});a||!V?p.add({severity:"error",summary:"Ошибка!",detail:JSON.stringify(a,void 0,2)}):(p.add({severity:"success",summary:"Статус обновлен!"}),await f())}return(e,r)=>{const t=A("FormKit");return i(),u(S,null,{default:s(()=>[o.value?(i(),u(t,{key:0,modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=a=>o.value=a),type:"form",actions:!1},{default:s(()=>[n(S,null,{default:s(()=>[n(g,{readonly:!0,"order-name":"#"+m(d)},null,8,["order-name"])]),_:1})]),_:1},8,["modelValue"])):_("",!0),o.value?(i(),u(t,{key:1,ref_key:"orderStatusForm",ref:c,modelValue:o.value.orderStatus,"onUpdate:modelValue":r[1]||(r[1]=a=>o.value.orderStatus=a),type:"form",actions:!1,onSubmit:I},{default:s(()=>[n(q,null,{default:s(()=>[n(v,{id:m(d),readonly:!1,onUpdate:P},null,8,["id"])]),_:1})]),_:1},8,["modelValue"])):_("",!0),n(B,{"order-id":m(d),mode:"moder"},null,8,["order-id"])]),_:1})}}});export{Q as default};
